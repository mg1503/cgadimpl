
std::shared_ptr<Node> relumask_nodeops(const std::shared_ptr<Node>& x) {
    const Tensor& xin = x->value;
    Tensor y = OwnTensor::Tensor::zeros(xin.shape(), ag::options(xin));
    if (xin.is_cpu()) {
        dispatch_by_dtype(xin.dtype(), [&](auto dummy){
            using T = decltype(dummy);
            const T* x_data = xin.data<T>();
            T* y_data = y.data<T>();
            for (int64_t i = 0; i < xin.numel(); ++i) {
                bool is_positive;
                if constexpr (std::is_same_v<T, OwnTensor::complex32_t> || 
                              std::is_same_v<T, OwnTensor::complex64_t> || 
                              std::is_same_v<T, OwnTensor::complex128_t>) {
                    is_positive = x_data[i].real() > 0;
                } else {
                    is_positive = x_data[i] > static_cast<T>(0);
                }
                if (is_positive) {
                    y_data[i] = static_cast<T>(1.0f);
                }
            }
        });
    } else {
        throw std::runtime_error("relumask_nodeops not implemented for CUDA yet.");
    }
    auto n = std::make_shared<Node>(y, Op::Relumask, x->requires_grad(), "relumask");
    n->inputs = {x};
    if(x) x->child_grad_count++;
    ag::debug::on_node_created(n);
    return n;
}
